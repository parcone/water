{"ast":null,"code":"import { ref, onMounted, onBeforeUnmount, watch, computed } from 'vue';\nimport * as echarts from 'echarts';\nimport { debounce } from 'lodash-es';\nexport default {\n  name: 'BaseEChart',\n  props: {\n    options: {\n      type: Object,\n      required: true\n    },\n    width: {\n      type: String,\n      default: '100%'\n    },\n    height: {\n      type: String,\n      default: '100%'\n    },\n    minHeight: {\n      type: String,\n      default: '300px'\n    },\n    theme: {\n      type: String,\n      default: ''\n    }\n  },\n  emits: ['chartReady', 'chartError'],\n  setup(props, {\n    emit\n  }) {\n    const chartRef = ref(null);\n    let chart = null;\n    const isInitialized = ref(false);\n    const computedMinHeight = computed(() => {\n      return props.height === '100%' ? props.minHeight : 'auto';\n    });\n\n    // 初始化图表\n    const initChart = async () => {\n      try {\n        if (!chartRef.value || isInitialized.value) return;\n\n        // 等待DOM更新\n        await new Promise(resolve => setTimeout(resolve, 0));\n        if (!chartRef.value) {\n          throw new Error('Chart container not found');\n        }\n        chart = echarts.init(chartRef.value, props.theme);\n        chart.setOption(props.options, true);\n        isInitialized.value = true;\n        emit('chartReady', chart);\n\n        // 监听窗口大小变化\n        window.addEventListener('resize', handleResize);\n      } catch (error) {\n        console.error('Chart initialization failed:', error);\n        emit('chartError', error);\n      }\n    };\n\n    // 防抖处理窗口大小变化\n    const handleResize = debounce(() => {\n      if (chart && chartRef.value) {\n        chart.resize();\n      }\n    }, 100);\n\n    // 更新图表选项\n    const updateChart = () => {\n      if (!chart || !chartRef.value) return;\n      try {\n        chart.setOption(props.options, true);\n      } catch (error) {\n        console.error('Chart update failed:', error);\n        emit('chartError', error);\n      }\n    };\n\n    // 监听选项变化\n    watch(() => props.options, () => {\n      if (isInitialized.value) {\n        updateChart();\n      }\n    }, {\n      deep: true\n    });\n\n    // 生命周期钩子\n    onMounted(() => {\n      initChart();\n    });\n    onBeforeUnmount(() => {\n      if (!chart) return;\n      window.removeEventListener('resize', handleResize);\n      chart.dispose();\n      chart = null;\n      isInitialized.value = false;\n    });\n    return {\n      chartRef,\n      computedMinHeight\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","onBeforeUnmount","watch","computed","echarts","debounce","name","props","options","type","Object","required","width","String","default","height","minHeight","theme","emits","setup","emit","chartRef","chart","isInitialized","computedMinHeight","initChart","value","Promise","resolve","setTimeout","Error","init","setOption","window","addEventListener","handleResize","error","console","resize","updateChart","deep","removeEventListener","dispose"],"sources":["D:\\restore\\water-melt\\frontend\\src\\components\\BaseEChart.vue"],"sourcesContent":["<!-- ECharts基础组件 -->\r\n<template>\r\n  <div \r\n    ref=\"chartRef\" \r\n    :style=\"{ \r\n      width: width, \r\n      height: height,\r\n      minHeight: computedMinHeight\r\n    }\"\r\n  ></div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, onMounted, onBeforeUnmount, watch, computed } from 'vue'\r\nimport * as echarts from 'echarts'\r\nimport { debounce } from 'lodash-es'\r\n\r\nexport default {\r\n  name: 'BaseEChart',\r\n  props: {\r\n    options: {\r\n      type: Object,\r\n      required: true\r\n    },\r\n    width: {\r\n      type: String,\r\n      default: '100%'\r\n    },\r\n    height: {\r\n      type: String,\r\n      default: '100%'\r\n    },\r\n    minHeight: {\r\n      type: String,\r\n      default: '300px'\r\n    },\r\n    theme: {\r\n      type: String,\r\n      default: ''\r\n    }\r\n  },\r\n  emits: ['chartReady', 'chartError'],\r\n  setup(props, { emit }) {\r\n    const chartRef = ref(null)\r\n    let chart = null\r\n    const isInitialized = ref(false)\r\n\r\n    const computedMinHeight = computed(() => {\r\n      return props.height === '100%' ? props.minHeight : 'auto'\r\n    })\r\n\r\n    // 初始化图表\r\n    const initChart = async () => {\r\n      try {\r\n        if (!chartRef.value || isInitialized.value) return\r\n        \r\n        // 等待DOM更新\r\n        await new Promise(resolve => setTimeout(resolve, 0))\r\n        \r\n        if (!chartRef.value) {\r\n          throw new Error('Chart container not found')\r\n        }\r\n\r\n        chart = echarts.init(chartRef.value, props.theme)\r\n        chart.setOption(props.options, true)\r\n        isInitialized.value = true\r\n        emit('chartReady', chart)\r\n\r\n        // 监听窗口大小变化\r\n        window.addEventListener('resize', handleResize)\r\n      } catch (error) {\r\n        console.error('Chart initialization failed:', error)\r\n        emit('chartError', error)\r\n      }\r\n    }\r\n\r\n    // 防抖处理窗口大小变化\r\n    const handleResize = debounce(() => {\r\n      if (chart && chartRef.value) {\r\n        chart.resize()\r\n      }\r\n    }, 100)\r\n\r\n    // 更新图表选项\r\n    const updateChart = () => {\r\n      if (!chart || !chartRef.value) return\r\n      try {\r\n        chart.setOption(props.options, true)\r\n      } catch (error) {\r\n        console.error('Chart update failed:', error)\r\n        emit('chartError', error)\r\n      }\r\n    }\r\n\r\n    // 监听选项变化\r\n    watch(\r\n      () => props.options,\r\n      () => {\r\n        if (isInitialized.value) {\r\n          updateChart()\r\n        }\r\n      },\r\n      { deep: true }\r\n    )\r\n\r\n    // 生命周期钩子\r\n    onMounted(() => {\r\n      initChart()\r\n    })\r\n\r\n    onBeforeUnmount(() => {\r\n      if (!chart) return\r\n      window.removeEventListener('resize', handleResize)\r\n      chart.dispose()\r\n      chart = null\r\n      isInitialized.value = false\r\n    })\r\n\r\n    return {\r\n      chartRef,\r\n      computedMinHeight\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\ndiv {\r\n  position: relative;\r\n}\r\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}