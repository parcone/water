{"ast":null,"code":"import { ref, onMounted, onUnmounted } from 'vue';\nimport { Plus, Minus, Loading } from '@element-plus/icons-vue';\nimport * as L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nexport default {\n  __name: 'BaseMap',\n  props: {\n    center: {\n      type: Array,\n      default: () => [39.916527, 116.397128] // 默认北京中心坐标\n    },\n    zoom: {\n      type: Number,\n      default: 13\n    },\n    markers: {\n      type: Array,\n      default: () => []\n    }\n  },\n  emits: ['marker-click', 'map-ready'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const props = __props;\n    const emit = __emit;\n    const mapContainer = ref(null);\n    const loading = ref(true);\n    let map = null;\n\n    // 初始化地图\n    onMounted(async () => {\n      if (!mapContainer.value) return;\n\n      // 创建地图实例\n      map = L.map(mapContainer.value, {\n        center: props.center,\n        zoom: props.zoom,\n        zoomControl: false\n      });\n\n      // 添加图层\n      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        attribution: '© OpenStreetMap contributors'\n      }).addTo(map);\n\n      // 添加标记\n      updateMarkers();\n      loading.value = false;\n      emit('map-ready', map);\n    });\n\n    // 更新标记\n    const updateMarkers = () => {\n      if (!map) return;\n\n      // 清除现有标记\n      map.eachLayer(layer => {\n        if (layer instanceof L.Marker) {\n          map.removeLayer(layer);\n        }\n      });\n\n      // 添加新标记\n      props.markers.forEach(marker => {\n        const {\n          position,\n          icon,\n          popup\n        } = marker;\n        const markerInstance = L.marker(position, {\n          icon: icon ? L.icon(icon) : undefined\n        }).addTo(map);\n        if (popup) {\n          markerInstance.bindPopup(popup);\n        }\n        markerInstance.on('click', () => {\n          emit('marker-click', marker);\n        });\n      });\n    };\n\n    // 缩放控制\n    const handleZoom = delta => {\n      if (!map) return;\n      map.setZoom(map.getZoom() + delta);\n    };\n\n    // 组件销毁时清理\n    onUnmounted(() => {\n      if (map) {\n        map.remove();\n        map = null;\n      }\n    });\n\n    // 监听属性变化\n    watch(() => props.markers, updateMarkers, {\n      deep: true\n    });\n    watch(() => props.center, newCenter => {\n      if (map) {\n        map.setView(newCenter, map.getZoom());\n      }\n    });\n    watch(() => props.zoom, newZoom => {\n      if (map) {\n        map.setZoom(newZoom);\n      }\n    });\n    const __returned__ = {\n      props,\n      emit,\n      mapContainer,\n      loading,\n      get map() {\n        return map;\n      },\n      set map(v) {\n        map = v;\n      },\n      updateMarkers,\n      handleZoom,\n      ref,\n      onMounted,\n      onUnmounted,\n      get Plus() {\n        return Plus;\n      },\n      get Minus() {\n        return Minus;\n      },\n      get Loading() {\n        return Loading;\n      },\n      get L() {\n        return L;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","onUnmounted","Plus","Minus","Loading","L","props","__props","emit","__emit","mapContainer","loading","map","value","center","zoom","zoomControl","tileLayer","attribution","addTo","updateMarkers","eachLayer","layer","Marker","removeLayer","markers","forEach","marker","position","icon","popup","markerInstance","undefined","bindPopup","on","handleZoom","delta","setZoom","getZoom","remove","watch","deep","newCenter","setView","newZoom"],"sources":["D:/restore/water-melt/frontend/src/components/BaseMap.vue"],"sourcesContent":["<!-- 基础地图组件 -->\r\n<template>\r\n  <div class=\"base-map-container\">\r\n    <div ref=\"mapContainer\" class=\"map-container\"></div>\r\n    <div class=\"map-overlay\" v-if=\"loading\">\r\n      <el-icon class=\"is-loading\"><Loading /></el-icon>\r\n    </div>\r\n    <div class=\"map-controls\">\r\n      <el-button-group>\r\n        <el-button :icon=\"Plus\" @click=\"handleZoom(1)\" circle></el-button>\r\n        <el-button :icon=\"Minus\" @click=\"handleZoom(-1)\" circle></el-button>\r\n      </el-button-group>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, onUnmounted } from 'vue'\r\nimport { Plus, Minus, Loading } from '@element-plus/icons-vue'\r\nimport * as L from 'leaflet'\r\nimport 'leaflet/dist/leaflet.css'\r\n\r\nconst props = defineProps({\r\n  center: {\r\n    type: Array,\r\n    default: () => [39.916527, 116.397128] // 默认北京中心坐标\r\n  },\r\n  zoom: {\r\n    type: Number,\r\n    default: 13\r\n  },\r\n  markers: {\r\n    type: Array,\r\n    default: () => []\r\n  }\r\n})\r\n\r\nconst emit = defineEmits(['marker-click', 'map-ready'])\r\n\r\nconst mapContainer = ref(null)\r\nconst loading = ref(true)\r\nlet map = null\r\n\r\n// 初始化地图\r\nonMounted(async () => {\r\n  if (!mapContainer.value) return\r\n\r\n  // 创建地图实例\r\n  map = L.map(mapContainer.value, {\r\n    center: props.center,\r\n    zoom: props.zoom,\r\n    zoomControl: false\r\n  })\r\n\r\n  // 添加图层\r\n  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n    attribution: '© OpenStreetMap contributors'\r\n  }).addTo(map)\r\n\r\n  // 添加标记\r\n  updateMarkers()\r\n\r\n  loading.value = false\r\n  emit('map-ready', map)\r\n})\r\n\r\n// 更新标记\r\nconst updateMarkers = () => {\r\n  if (!map) return\r\n\r\n  // 清除现有标记\r\n  map.eachLayer((layer) => {\r\n    if (layer instanceof L.Marker) {\r\n      map.removeLayer(layer)\r\n    }\r\n  })\r\n\r\n  // 添加新标记\r\n  props.markers.forEach(marker => {\r\n    const { position, icon, popup } = marker\r\n    \r\n    const markerInstance = L.marker(position, {\r\n      icon: icon ? L.icon(icon) : undefined\r\n    }).addTo(map)\r\n\r\n    if (popup) {\r\n      markerInstance.bindPopup(popup)\r\n    }\r\n\r\n    markerInstance.on('click', () => {\r\n      emit('marker-click', marker)\r\n    })\r\n  })\r\n}\r\n\r\n// 缩放控制\r\nconst handleZoom = (delta) => {\r\n  if (!map) return\r\n  map.setZoom(map.getZoom() + delta)\r\n}\r\n\r\n// 组件销毁时清理\r\nonUnmounted(() => {\r\n  if (map) {\r\n    map.remove()\r\n    map = null\r\n  }\r\n})\r\n\r\n// 监听属性变化\r\nwatch(() => props.markers, updateMarkers, { deep: true })\r\nwatch(() => props.center, (newCenter) => {\r\n  if (map) {\r\n    map.setView(newCenter, map.getZoom())\r\n  }\r\n})\r\nwatch(() => props.zoom, (newZoom) => {\r\n  if (map) {\r\n    map.setZoom(newZoom)\r\n  }\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.base-map-container {\r\n  position: relative;\r\n  width: 100%;\r\n  height: 100%;\r\n  min-height: 400px;\r\n  border-radius: 8px;\r\n  overflow: hidden;\r\n  background: #f5f7fa;\r\n}\r\n\r\n.map-container {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.map-overlay {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background: rgba(255, 255, 255, 0.8);\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  z-index: 1000;\r\n}\r\n\r\n.map-controls {\r\n  position: absolute;\r\n  bottom: 20px;\r\n  right: 20px;\r\n  z-index: 1000;\r\n}\r\n\r\n:deep(.leaflet-container) {\r\n  background: #f5f7fa;\r\n}\r\n\r\n:deep(.leaflet-control-attribution) {\r\n  background: rgba(255, 255, 255, 0.8);\r\n  padding: 0 5px;\r\n  border-radius: 4px;\r\n}\r\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}